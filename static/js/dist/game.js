class ChooseSkin{constructor(t){this.root=t,this.$choose_skin=$('\n<div class = "ac-game-choose-skin">\n    <audio class="ac-game-choose-skin-sound" src = "" autoplay=\'autoplay\'></audio>\n    <audio class="ac-game-choose-skin-bgm" src="" autoplay=\'autoplay\' loop=\'loop\'></audio>\n    <img class = "ac-game-choose-skin-show" src = "https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/hutao.png">\n    <div class = "ac-game-choose-skin-change-left">\n    </div>\n    <div class = "ac-game-choose-skin-change-right">\n    </div>\n    <p class = "ac-game-choose-skin-name"></p>\n    <div class = "ac-game-choose-skin-sure">确定</div>\n</div>\n'),this.$choose_skin.hide(),this.root.$ac_game.append(this.$choose_skin),this.width=this.$choose_skin.width(),this.height=this.$choose_skin.height(),this.$canvas=$("<canvas></canvas>"),this.ctx=this.$canvas[0].getContext("2d"),this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.id=0,this.mode=null,this.$left_mode=this.$choose_skin.find(".ac-game-choose-skin-change-left"),this.$right_mode=this.$choose_skin.find(".ac-game-choose-skin-change-right"),this.$sure_mode=this.$choose_skin.find(".ac-game-choose-skin-sure"),this.start()}start(){this.add_listening_events(),this.draw_skin()}get_random_meme(){let t=Math.floor(Math.random()*meme.length);for(;0===t;)t=Math.floor(Math.random()*meme.length);return t}add_listening_events(){let t=this;this.$left_mode.click((function(){t.id--,t.id<0&&(t.id=meme.length-1),t.draw_skin(),t.change_bgm()})),this.$right_mode.click((function(){t.id++,t.id===meme.length&&(t.id=0),t.draw_skin(),t.change_bgm()})),this.$sure_mode.click((function(){t.hide(),0===t.id&&(t.id=t.get_random_meme()),t.draw_skin(),document.getElementsByClassName("ac-game-choose-skin-bgm")[0].src="",t.ctx.clearRect(0,0,t.width,t.height),t.root.playground.show(t.mode,t.id)}))}show(t){this.$choose_skin.show(),this.mode=t}hide(){this.$choose_skin.hide()}draw_skin(){document.getElementsByClassName("ac-game-choose-skin-show")[0].src=meme[this.id],document.getElementsByClassName("ac-game-choose-skin-name")[0].innerHTML=skin_name[this.id]}change_bgm(){let t=document.getElementsByClassName("ac-game-choose-skin-sound")[0];t.src=choose_skin_bgm[this.id],t.volume=.75;let i=document.getElementsByClassName("ac-game-choose-skin-bgm")[0];i.src=music_src[this.id],i.volume=.5}}class AcGameMenu{constructor(t){this.root=t,this.$menu=$('\n<div class="ac-game-menu">\n       <div class="ac_game_menu_game_option">\n        <div class="ac_game_menu_game_option_headline">游戏公告</div>\n        <div class="ac_game_menu_game_option_operator">&nbsp&nbsp&nbsp&nbsp<a href = "https://blog.zzdnb.cn/archives/guan-yu-you-xi-de-shuo-ming" target="_blank"><b><font color="#FF0000">游戏说明</font></b></a>（点击左方查看）</div>\n    <div class="ac_game_menu_game_option_operator">&nbsp&nbsp&nbsp&nbsp欢迎关注个人博客：<a href = "https://blog.zzdnb.cn/" target="_blank"><font color="#05c256"><b>福尔摩东的blog</font><b></a></div>\n    <div class="ac_game_menu_game_option_operator">初次登录，若服务器带宽问题加载较慢，请见谅！</div>\n\n    </div> \n    <div class="ac-game-menu-field">\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-single-mode">\n            单人模式\n        </div>\n        <img class = "ac-game-menu-op-img ac-game-menu-op-img-single" src = "https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/ganyu_hope.png" >\n        <br>\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-multi-mode">\n            天梯模式\n        </div>\n        <img class = "ac-game-menu-op-img ac-game-menu-op-img-multi" src = "https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/ganyu_star.png" >\n        <br>\n        <div class="ac-game-menu-field-item ac-game-menu-field-item-settings">\n            退出\n        </div>\n        <img class = "ac-game-menu-op-img ac-game-menu-op-img-settings" src = "https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/qiqi_lay.jpg" >\n    </div>\n</div>\n'),this.$menu.hide(),this.root.$ac_game.append(this.$menu),this.$single_mode=this.$menu.find(".ac-game-menu-field-item-single-mode"),this.$multi_mode=this.$menu.find(".ac-game-menu-field-item-multi-mode"),this.$settings=this.$menu.find(".ac-game-menu-field-item-settings"),this.start()}start(){this.add_listening_events()}add_listening_events(){let t=this,i=document.getElementsByClassName("ac-game-menu-bgm")[0];this.$single_mode.click((function(){t.hide(),t.root.choose_skin.show("single mode"),t.root.choose_skin.change_bgm(),i.src=""})),this.$multi_mode.click((function(){t.hide(),t.root.choose_skin.show("multi mode"),t.root.choose_skin.change_bgm(),i.src=""})),this.$settings.click((function(){t.root.settings.logout_on_remote()}))}show(){this.$menu.show(),document.getElementsByClassName("ac-game-menu-bgm")[0].src=menu_bgm}hide(){this.$menu.hide()}}let last_timestamp,AC_GAME_OBJECTS=[];class AcGameObject{constructor(){AC_GAME_OBJECTS.push(this),this.has_called_start=!1,this.timedelta=0,this.uuid=this.create_uuid()}create_uuid(){let t="";for(let i=0;i<20;i++){t+=parseInt(Math.floor(10*Math.random()))}return t}start(){}update(){}late_update(){}on_destroy(){}destroy(){this.on_destroy();for(let t=0;t<AC_GAME_OBJECTS.length;t++)if(AC_GAME_OBJECTS[t]===this){AC_GAME_OBJECTS.splice(t,1);break}}}let AC_GAME_ANIMATION=function(t){for(let i=0;i<AC_GAME_OBJECTS.length;i++){let s=AC_GAME_OBJECTS[i];s.has_called_start?(s.timedelta=t-last_timestamp,s.update()):(s.start(),s.has_called_start=!0)}for(let t=0;t<AC_GAME_OBJECTS.length;t++){AC_GAME_OBJECTS[t].late_update()}last_timestamp=t,requestAnimationFrame(AC_GAME_ANIMATION)};requestAnimationFrame(AC_GAME_ANIMATION);class ChatField{constructor(t){this.playground=t,this.$history=$('<div class="ac-game-chat-field-history">历史信息：</div>'),this.$input=$('<input type="text" class = "ac-game-chat-field-input">'),this.$history.hide(),this.$input.hide(),this.func_id=null,this.playground.$playground.append(this.$history),this.playground.$playground.append(this.$input),this.start()}start(){this.add_listening_events(),this.resize()}resize(){this.margin_left=.6*(this.playground.$playground.width()-this.playground.width),this.history_top=(this.playground.$playground.height()-this.playground.height)/2+.5*this.playground.height,this.history_height=.33*this.playground.height,this.input_top=this.history_top+.02*this.playground.height+this.history_height,this.width=.15*this.playground.width,this.$history.css({position:"absolute",left:this.margin_left,top:this.history_top,width:this.width,height:this.history_height,color:"white","font-size":"2vh",overflow:"auto"}),this.$input.css({position:"absolute",left:this.margin_left,top:this.input_top,width:this.width,height:"3vh",color:"white","font-size":"2vh","background-color":"rgba(222,225,230,0.2)"})}add_listening_events(){let t=this;this.$input.keydown((function(i){if(27===i.which)return t.hide_input(),!1;if(13===i.which){let i=t.playground.root.settings.username,s=t.$input.val();s&&(t.$input.val(""),t.add_message(i,s),t.playground.mps.send_message(i,s))}}))}render_message(t){return $(`<div>${t}</div>`)}add_message(t,i){this.show_history();let s=`[${t}]：${i}`;this.$history.append(this.render_message(s)),this.$history.scrollTop(this.$history[0].scrollHeight)}show_history(){let t=this;this.$history.fadeIn(),this.func_id&&clearTimeout(this.func_id),this.func_id=setTimeout((function(){t.$history.fadeOut(),t.func_id=null}),5e3)}show_input(){this.show_history(),this.$input.show(),this.$input.focus()}hide_input(){this.$input.hide(),this.playground.game_map.$canvas.focus()}}class ColdWarning extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.spent_time=0,this.white_alpha=1,this.cyan_alpha=.01,this.control_alpha=!0,this.control_rate=0,this.change_next=1}start(){}update(){this.spent_time+=this.timedelta/1e3,this.playground.players.length>0&&"me"===this.playground.players[0].character?this.playground.players[0].cold_num>=70&&this.playground.players[0].cold_num<100?this.control_alpha?(this.control_rate+=.007,this.control_rate>=1&&(this.control_alpha=!1)):(this.control_rate-=.007,this.control_rate<=.2&&(this.control_alpha=!0)):100===this.playground.players[0].cold_num?this.control_rate=Math.min(this.control_rate+.007,1):this.control_rate=Math.max(this.control_rate-.007,0):this.control_rate=0,this.render()}render(){let t=null;t=this.ctx.createLinearGradient(0,this.playground.height/2,.2*this.playground.width,this.playground.height/2),t.addColorStop(0,"rgba(255,255,255,"+(this.white_alpha*this.control_rate).toString()+")"),t.addColorStop(1,"rgba(176,224,230,"+(this.cyan_alpha*this.control_rate).toString()+")"),this.ctx.lineWidth=0,this.ctx.fillStyle=t,this.ctx.fillRect(0,0,.2*this.playground.width,this.playground.height),t=this.ctx.createLinearGradient(this.playground.width,this.playground.height/2,.8*this.playground.width,this.playground.height/2),t.addColorStop(0,"rgba(255,255,255,"+(this.white_alpha*this.control_rate).toString()+")"),t.addColorStop(1,"rgba(176,224,230,"+(this.cyan_alpha*this.control_rate).toString()+")"),this.ctx.lineWidth=0,this.ctx.fillStyle=t,this.ctx.fillRect(.8*this.playground.width,0,.2*this.playground.width,this.playground.height),t=this.ctx.createLinearGradient(this.playground.width/2,0,this.playground.width/2,.2*this.playground.height),t.addColorStop(0,"rgba(255,255,255,"+(this.white_alpha*this.control_rate).toString()+")"),t.addColorStop(1,"rgba(176,224,230,"+(this.cyan_alpha*this.control_rate).toString()+")"),this.ctx.lineWidth=0,this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.playground.width,.2*this.playground.height),t=this.ctx.createLinearGradient(this.playground.width/2,this.playground.height,this.playground.width/2,.8*this.playground.height),t.addColorStop(0,"rgba(255,255,255,"+(this.white_alpha*this.control_rate).toString()+")"),t.addColorStop(1,"rgba(176,224,230,"+(this.cyan_alpha*this.control_rate).toString()+")"),this.ctx.lineWidth=0,this.ctx.fillStyle=t,this.ctx.fillRect(0,.8*this.playground.height,this.playground.width,.2*this.playground.height)}}class Grid extends AcGameObject{constructor(t,i,s,e,a,h){super(),this.playground=t,this.ctx=i,this.i=s,this.j=e,this.l=a,this.x=this.i*this.l,this.y=this.j*this.l,this.stroke_color=h,this.has_grass=!1,this.is_poisoned=!1,this.fill_color="rgb(210, 222, 238)",this.grass_color="rgb(213, 198, 76)"}start(){}get_manhattan_dist(t,i,s,e){return Math.max(Math.abs(t-s),Math.abs(i-e))}update(){this.render()}render(){let t=this.playground.scale,i=this.x-this.playground.cx,s=this.y-this.playground.cy,e=i+.5*this.l,a=s+.5*this.l;if(!(e*t<-.2*this.playground.width||e*t>1.2*this.playground.width||a*t<-.2*this.playground.height||a*t>1.2*this.playground.height)&&(this.render_grid(i,s,t),this.has_grass)){let e=this.playground.players[0];"me"===e.character&&this.get_manhattan_dist(this.x+this.l/2,this.y+this.l/2,e.x,e.y)<1.5*this.l?this.grass_color="rgba(213, 198, 76, 0.3)":this.grass_color="rgb(213, 198, 76)",this.render_grass(i,s,t)}}render_grid(t,i,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=.03*this.l*s,this.ctx.strokeStyle=this.stroke_color,this.ctx.rect(t*s,i*s,this.l*s,this.l*s),this.ctx.stroke(),this.ctx.restore()}render_grass(t,i,s){this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=0,this.ctx.rect(t*s,i*s,this.l*s,this.l*s),this.ctx.fillStyle=this.grass_color,this.ctx.fill(),this.ctx.restore()}}class Snow extends AcGameObject{constructor(t){super(),this.playground=t,this.x=Math.random()*this.playground.virtual_map_width,this.y=Math.random()*this.playground.virtual_map_height,this.radius=.005,this.next_radius=this.radius,this.inner_radius=0,this.color="rgba(255,255,255,"+.5*Math.random().toString()+")",this.vx=0,this.vy=.2+Math.random(),this.speed=.1,this.ctx=this.playground.game_map.ctx,this.change_next=1,this.eps=.01,this.spent_time=0}start(){}update(){this.spent_time+=this.timedelta/1e3,this.spent_time>this.change_next&&(this.change_next+=2+Math.random(),this.vx=Math.cos(Math.PI*Math.random())),this.update_move(),this.render()}update_move(){if(this.y>this.playground.virtual_map_height)return this.destroy(),!1;let t=this.speed*this.timedelta/1e3;this.x+=this.vx*t*.2,this.y+=this.vy*t,this.render()}render(){let t=this.playground.scale,i=this.x-this.playground.cx,s=this.y-this.playground.cy;i<-.2*this.playground.width/t||i>1.2*this.playground.width/t||s<-.2*this.playground.height/t||s>1.2*this.playground.height/t||(this.ctx.beginPath(),this.ctx.arc(i*t,s*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill())}}class GameMap extends AcGameObject{constructor(t){super(),this.playground=t,this.$canvas=$('<canvas class = "ac-game-playground-game-map" tabindex=0></canvas>'),this.ctx=this.$canvas[0].getContext("2d"),this.ctx.canvas.width=this.playground.width,this.ctx.canvas.height=this.playground.height,this.playground.$playground.append(this.$canvas);let i=this.playground.virtual_map_width,s=this.playground.virtual_map_height;this.l=.05*s,this.nx=Math.ceil(i/this.l),this.ny=Math.ceil(s/this.l)}start(){this.$canvas.focus()}resize(){this.ctx.canvas.width=this.playground.width,this.ctx.canvas.height=this.playground.height,this.ctx.fillStyle="rgba(176,224,230)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}update(){this.render()}render(){if(this.playground.players.length>0&&"me"===this.playground.players[0].character?this.ctx.fillStyle="rgba(176,224,230, 0.8)":this.ctx.fillStyle="rgba(0, 0, 0, 0.2)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),Math.random()>.2&&new Snow(this.playground,0,0),this.playground.players.length>0&&"me"!=this.playground.players[0].character){document.getElementsByClassName("ac-game-playground")[0].style.background="black";let t=document.getElementsByClassName("ac-game-playground-bgm")[0];"https://app27.acapp.acwing.com.cn/static/audio/playground/end_bgm.mp3"!=t.src&&(t.src="https://app27.acapp.acwing.com.cn/static/audio/playground/end_bgm.mp3")}}}class MiniMap extends AcGameObject{constructor(t){super(),this.playground=t,this.$canvas=$('<canvas class="mini-map"></canvas>'),this.ctx=this.$canvas[0].getContext("2d"),this.bg_color="rgba(0, 0, 0, 0.3)",this.bright_color="rgba(247, 232, 200, 0.7)",this.players=this.playground.players,this.warmers=this.playground.warmers,this.pos_x=this.playground.width-.3*this.playground.height,this.pos_y=.7*this.playground.height,this.width=.3*this.playground.height,this.height=this.width,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.playground.$playground.append(this.$canvas),this.real_map_width=this.playground.virtual_map_width,this.lock=!1,this.drag=!1}start(){this.add_listening_events()}resize(){this.pos_x=this.playground.width-.3*this.playground.height,this.pos_y=.7*this.playground.height,this.width=.3*this.playground.height,this.height=this.width,this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.margin_right=(this.playground.$playground.width()-this.playground.width)/2,this.margin_bottom=(this.playground.$playground.height()-this.playground.height)/2,this.$canvas.css({position:"absolute",right:this.margin_right,bottom:this.margin_bottom})}add_listening_events(){let t=this;this.$canvas.on("contextmenu",(function(){return!1})),this.$canvas.mousedown((function(i){if("single mode"===t.playground.mode||"multi mode"===t.playground.mode&&"fighting"===t.playground.state){const s=t.ctx.canvas.getBoundingClientRect();let e=i.clientX-s.left,a=i.clientY-s.top,h=e/t.width*t.playground.virtual_map_width,r=a/t.height*t.playground.virtual_map_height;if(1===i.which)t.lock=!0,t.drag=!1,t.playground.focus_player=null,t.playground.re_cx_cy(h,r),t.rect_x1=e-t.playground.width/2/t.playground.scale/t.playground.virtual_map_width*t.width,t.rect_y1=a-t.playground.height/2/t.playground.scale/t.playground.virtual_map_height*t.height;else if(3===i.which){let i=t.playground.players[0];"me"===i.character&&(i.move_to(h,r),"multi mode"===t.playground.mode&&t.playground.mps.send_move_to(h,r))}}t.playground.game_map.$canvas.focus()})),this.$canvas.mousemove((function(i){if("single mode"===t.playground.mode||"multi mode"===t.playground.mode&&"fighting"===t.playground.state){const s=t.ctx.canvas.getBoundingClientRect();let e=i.clientX-s.left,a=i.clientY-s.top,h=e/t.width*t.playground.virtual_map_width,r=a/t.height*t.playground.virtual_map_height;1===i.which&&t.lock&&(t.drag=!0,t.playground.focus_player=null,t.playground.re_cx_cy(h,r),t.rect_x1=e-t.playground.width/2/t.playground.scale/t.playground.virtual_map_width*t.width,t.rect_y1=a-t.playground.height/2/t.playground.scale/t.playground.virtual_map_height*t.height)}t.playground.game_map.$canvas.focus()})),this.$canvas.mouseup((function(i){("single mode"===t.playground.mode||"multi mode"===t.playground.mode&&"fighting"===t.playground.state)&&t.lock&&(t.lock=!1),t.playground.game_map.$canvas.focus()}))}update(){this.render()}render(){let t=this.playground.scale;this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle=this.bg_color,this.ctx.fillRect(0,0,this.width,this.height),this.playground.focus_player&&(this.rect_x1=(this.playground.focus_player.x-this.playground.width/2/t)/this.real_map_width*this.width,this.rect_y1=(this.playground.focus_player.y-this.playground.height/2/t)/this.real_map_width*this.height);let i=this.playground.width/t/this.real_map_width*this.width,s=this.playground.height/t/this.real_map_width*this.height;this.ctx.save(),this.ctx.strokeStyle=this.bright_color,this.ctx.setLineDash([15,5]),this.ctx.lineWidth=Math.ceil(3*t/1080),this.rect_x1=Math.min(this.rect_x1,this.width-i),this.rect_x1=Math.max(this.rect_x1,0),this.rect_y1=Math.min(this.rect_y1,this.height-s),this.rect_y1=Math.max(this.rect_y1,0),this.ctx.strokeRect(this.rect_x1,this.rect_y1,i,s),this.ctx.restore();for(let t=0;t<this.players.length;t++){let i=this.players[t],s=i.x/this.real_map_width*this.width,e=i.y/this.real_map_width*this.height;this.ctx.beginPath(),this.ctx.arc(s,e,.025*this.width,0,2*Math.PI,!1),this.ctx.fillStyle=i.color,this.ctx.fill()}for(let t=0;t<this.warmers.length;t++){let i=this.warmers[t],s=i.x/this.real_map_width*this.width,e=i.y/this.real_map_width*this.height;this.ctx.beginPath(),this.ctx.arc(s,e,.025*this.width,0,2*Math.PI,!1),this.ctx.fillStyle="rgba(255,99,71,0.7)",this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(s,e,.075*this.width,0,2*Math.PI,!1),this.ctx.lineWidth=.8,this.ctx.strokeStyle="rgba(255,99,71,0.5)",this.ctx.stroke(),this.ctx.closePath()}}}class NoticeBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.text="已就绪：0人"}start(){}write(t){this.text=t}update(){this.render()}render(){this.ctx.font="20px serif",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText(this.text,this.playground.width/2,20)}}class Particle extends AcGameObject{constructor(t,i,s,e,a,h,r,n,o){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.x=i,this.y=s,this.radius=e,this.vx=a,this.vy=h,this.color=r,this.speed=n,this.move_length=o,this.friction=.9,this.eps=.01}start(){}update(){if(this.move_length<this.eps||this.speed<this.eps)return this.destroy(),!1;let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t,this.speed*=this.friction,this.render()}render(){let t=this.playground.scale,i=this.x-this.playground.cx,s=this.y-this.playground.cy;i<-.2*this.playground.width/t||i>1.2*this.playground.width/t||s<-.2*this.playground.height/t||s>1.2*this.playground.height/t||(this.ctx.beginPath(),this.ctx.arc(i*t,s*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill())}}class Player extends AcGameObject{constructor(t,i,s,e,a,h,r,n,o){if(super(),this.x=i,this.y=s,this.playground=t,this.ctx=this.playground.game_map.ctx,this.radius=e,this.origin_speed=h,this.speed=h,this.color=a,this.character=r,this.username=n,this.sure_skin=o,this.is_cold=!0,this.is_cold_max=!1,this.cold_num=0,this.next_update_code_num=0,this.next_reduce_code_num=0,this.next_reduce_hp=0,this.next_update_pos=1,this.draw_hp_ftime=null,this.draw_hp_time=3,this.eps=.01,this.vx=0,this.vy=0,this.move_length=0,this.friction=.94,this.spent_time=0,this.damage_x=0,this.damage_y=0,this.damage_speed=0,this.default_damage_speed=1.5,this.fireballs=[],this.cur_skill=null,this.skill_stime=0,this.skill_ptime=0,this.skill_ftime=0,this.skill_over=!0,this.skill_ready=!1,this.need_draw=!1,this.character,this.q_cd=1.5,this.e_show_circle=!1,this.e_stime=null,this.e_ftime=null,this.e_last_time=.2,this.d_show_circle=!1,this.d_make_time=null,this.d_cold_time=2,this.d_can=!0,this.hp=100,this.tv=0,this.hp_length=1,this.cold_length=0,this.style_one_max_hp=100,this.style_one_radius=.05,this.style_one_speed=.15,this.style_two_max_hp=80,this.style_two_radius=this.style_one_radius,this.style_two_speed=1.4*this.style_one_speed,this.style_three_max_hp=50,this.style_three_radius=this.style_two_radius,this.style_three_speed=1.4*this.style_two_speed,this.style_four_max_hp=20,this.style_four_radius=this.style_three_radius,this.style_four_speed=1.4*this.style_three_speed,this.mouseX=0,this.mouseY=0,"me"===this.character||"enemy"===this.character){this.img=new Image,this.img.src=meme[this.sure_skin];let t=document.getElementsByClassName("ac-game-playground-bgm")[0];"me"===this.character&&(t.src=music_src[this.sure_skin],t.volume=.5)}else"robot"===this.character&&(this.img=new Image,this.img.src=this.playground.get_random_enemys())}start(){if("multi mode"===this.playground.mode&&(this.playground.player_count++,this.playground.notice_board.write("已就绪："+this.playground.player_count+"人"),this.playground.player_count>=2&&(this.playground.state="fighting",this.playground.notice_board.write("Fighting"))),"me"===this.character)this.add_listening_events();else if("robot"===this.character){let t=Math.random()*this.playground.virtual_map_width,i=Math.random()*this.playground.virtual_map_height;this.move_to(t,i)}}add_listening_events(){let t=this;this.playground.game_map.$canvas.on("contextmenu",(function(){return!1})),this.playground.game_map.$canvas.mousedown((function(i){if("single mode"===t.playground.mode||"multi mode"===t.playground.mode&&"fighting"===t.playground.state){const s=t.ctx.canvas.getBoundingClientRect();if(3===i.which){for(let e=0;e<10+10*Math.random();e++){let e=.05*Math.random()*.1,a=2*Math.PI*Math.random(),h=Math.cos(a),r=Math.sin(a),n=t.color,o=.75,l=.05*Math.random()*3.5;new Particle(t.playground,(i.clientX-s.left)/t.playground.scale+t.playground.cx,(i.clientY-s.top)/t.playground.scale+t.playground.cy,e,h,r,n,o,l)}let e=(i.clientX-s.left)/t.playground.scale+t.playground.cx,a=(i.clientY-s.top)/t.playground.scale+t.playground.cy;t.move_to(e,a),"multi mode"===t.playground.mode&&t.playground.mps.send_move_to(e,a)}}})),this.playground.game_map.$canvas.keydown((function(i){if(13===i.which){if("multi mode"===t.playground.mode)return t.playground.chat_field.show_input(),!1}else 27===i.which&&"multi mode"===t.playground.mode&&t.playground.chat_field.hide_input();("single mode"===t.playground.mode||"multi mode"===t.playground.mode&&"fighting"===t.playground.state)&&(t.playground.players.length>0&&"me"===t.playground.players[0].character&&t.skill_over&&(81===i.which?(t.skill_stime=t.spent_time,t.cur_skill="q",t.need_draw=!0):87===i.which?t.cur_skill="w":70===i.which?t.cur_skill="f":69===i.which?(t.cur_skill="e",t.e_show_circle=!0):68===i.which&&t.hp>5?(t.cur_skill="d",t.d_show_circle=!0):32!==i.which&&49!==i.which||(t.playground.focus_player=t,t.playground.re_cx_cy(t.x,t.y))),t.skill_over=!1)})),this.playground.game_map.$canvas.keypress((function(i){if(("single mode"===t.playground.mode||"multi mode"===t.playground.mode&&"fighting"===t.playground.state)&&(t.playground.players.length>0&&"me"===t.playground.players[0].character&&(t.skill_ptime=t.spent_time-t.skill_stime),t.skill_ptime>=t.q_cd&&!1===t.skill_ready&&t.need_draw)){for(let i=0;i<15+10*Math.random();i++){let i=t.x,s=t.y,e=.05*Math.random()*.2,a=2*Math.PI*Math.random(),h=Math.cos(a),r=Math.sin(a),n="CornflowerBlue",o=.75,l=.05*Math.random()*3.5;new Particle(t.playground,i,s,e,h,r,n,o,l)}t.skill_ready=!0}})),this.playground.game_map.$canvas.on("mousemove",(function(i){const s=t.ctx.canvas.getBoundingClientRect();t.mouseX=(i.clientX-s.left)/t.playground.scale,t.mouseY=(i.clientY-s.top)/t.playground.scale})),this.playground.game_map.$canvas.keyup((function(i){if("single mode"===t.playground.mode||"multi mode"===t.playground.mode&&"fighting"===t.playground.state){if(t.skill_ftime=t.spent_time,t.playground.players.length>0&&"me"===t.playground.players[0].character)if("q"===t.cur_skill){t.is_cold&&(t.cold_num=Math.min(100,t.cold_num+1));let i=t.mouseX+t.playground.cx,s=t.mouseY+t.playground.cy;if(t.skill_ptime<t.q_cd){let e=t.shoot_fireball(i,s,!1);"multi mode"===t.playground.mode&&t.playground.mps.send_shoot_fireball(i,s,e.uuid,!1)}else{let e=t.shoot_fireball(i,s,!0);"multi mode"===t.playground.mode&&t.playground.mps.send_shoot_fireball(i,s,e.uuid,!0)}}else"d"===t.cur_skill?t.d_can&&(t.is_cold&&(t.cold_num=Math.min(100,t.cold_num+2)),t.diffusion(),t.d_make_time=t.spent_time,t.d_can=!1):"f"===t.cur_skill?(t.is_cold&&(t.cold_num=Math.min(100,t.cold_num+2)),t.traction()):"e"===t.cur_skill?(t.is_cold&&(t.cold_num=Math.min(100,t.cold_num+4)),t.e_stime=t.spent_time,t.e_ftime=t.e_stime+t.e_last_time):t.cur_skill;t.skill_over=!0,t.cur_skill=null,t.skill_ready=!1,t.skill_ptime=0,t.need_draw=!1,t.e_show_circle=!1,t.d_show_circle=!1}}))}shoot_fireball(t,i,s){let e=this.x,a=this.y,h=Math.atan2(i-this.y,t-this.x),r=Math.cos(h),n=Math.sin(h),o="robot"===this.character||"enemy"===this.character?"OrangeRed":"CornflowerBlue",l=2*this.speed;if("me"!==this.character||this.playground.players[0]==this){this.damage_speed=.3*this.default_damage_speed,this.damage_x=Math.cos(h-Math.PI),this.damage_y=Math.sin(h-Math.PI);for(let t=0;t<20+10*Math.random();t++){let t=this.x,i=this.y,e=.02*Math.random()*.2,a=2*Math.PI*Math.random(),h=Math.cos(a),r=Math.sin(a),n=null;n=s?"me"==this.character?"CornflowerBlue":"OrangeRed":"orange";let o=.5*this.default_damage_speed,l=1.5*this.radius+this.radius*Math.random();new Particle(this.playground,t,i,e,h,r,n,o,l)}if(s){let t=new FireBall(this.playground,this,e,a,.01,r,n,o,.6,1.3,5,!0,!0);return this.fireballs.push(t),t}{let t=new FireBall(this.playground,this,e,a,.01,r,n,"orange",l,1.3,5,!1,!1);return this.fireballs.push(t),t}}}destroy_fireball(t){if(t)for(let i=0;i<this.fireballs.length;i++){let s=this.fireballs[i];if(s.uuid===t){if(s.is_elastic)return!1;s.destroy();break}}}diffusion(){this.is_attacked(null,5,!0,!0),"multi mode"==this.playground.mode&&"me"===this.character&&this.playground.mps.send_make_diffusion_ball();for(let t=0;t<22.5;t++){let i=.0075,s=Math.PI/11.25*t,e=Math.cos(s),a=Math.sin(s),h="rgba(255,99,71, 0.6)",r=.5625,n=5*this.radius;new DiffusionBall(this.playground,this.x,this.y,i,e,a,h,r,n,this,!0)}for(let t=0;t<360;t++){let i=.001,s=Math.PI/180*t,e=Math.cos(s),a=Math.sin(s),h="rgba(255,99,71, 0.6)",r=1.6875,n=15*this.radius;new DiffusionBall(this.playground,this.x,this.y,i,e,a,h,r,n,this,!1)}if("me"===this.character)for(let t=0;t<AC_GAME_OBJECTS.length;t++){let i=AC_GAME_OBJECTS[t];if(i instanceof Player){let t=i;if(t!=this){if(this.get_dist(this.x,this.y,t.x,t.y)<5*this.radius){let i=Math.atan2(t.y-this.y,t.x-this.x);t.is_attacked(i,10,!1,!0),"multi mode"===this.playground.mode&&this.playground.mps.send_attack(t.uuid,t.x,t.y,i,10,null)}}}else if(i instanceof FireBall&&i.player!=this){this.get_dist(this.x,this.y,i.x,i.y)<10*this.radius&&("single mode"===this.playground.mode?i.destroy():this.playground.mps.send_destroy_ball(i.player.uuid,i.uuid))}}}traction(){for(let t=0;t<this.playground.players.length;t++){let i=this.playground.players[t];if(i!=this){if(this.get_dist(this.x,this.y,i.x,i.y)<5*this.radius){let t=Math.atan2(this.y-i.y,this.x-i.x);i.damage_x=Math.cos(t),i.damage_y=Math.sin(t),i.damage_speed=i.default_damage_speed,"multi mode"===this.playground.mode&&this.playground.mps.send_update_damage_player(i.uuid,i.damage_x,i.damage_y,i.damage_speed,i.x,i.y)}}}}blocked(){for(let t=0;t<AC_GAME_OBJECTS.length;t++){let i=AC_GAME_OBJECTS[t];if(i instanceof FireBall&&i.player!=this){if(this.get_dist(this.x,this.y,i.x,i.y)-i.radius-this.radius<1*this.radius){let t=Math.atan2(i.y-this.y,i.x-this.x);Math.random()>.5?t+=1*Math.random()/3*Math.PI:t-=1*Math.random()/3*Math.PI;let s=i.player;i.vx=Math.cos(t),i.vy=Math.sin(t),this.damage_speed=.4*this.default_damage_speed,this.damage_x=Math.cos(t-Math.PI),this.damage_y=Math.sin(t-Math.PI);for(let s=0;s<15+10*Math.random();s++){let s=.2*i.radius,e=t;Math.random()>.5?e+=1*Math.random()/6*Math.PI:e-=1*Math.random()/6*Math.PI;let a=Math.cos(e),h=Math.sin(e),r=i.color,n=1.125+1.125*Math.random(),o=10*this.radius*Math.random();new Particle(this.playground,i.x,i.y,s,a,h,r,n,o)}i.special_effect||(i.player=this,i.color="CornflowerBlue",i.move_length=i.origin_move_length,i.speed=.15*3,i.is_elastic=!0,i.special_effect=!0),"multi mode"===this.playground.mode&&this.playground.mps.send_block(this.uuid,s.uuid,i.uuid,i.vx,i.vy,t)}}}}get_dist(t,i,s,e){let a=t-s,h=i-e;return Math.sqrt(a*a+h*h)}move_to(t,i){this.move_length=this.get_dist(this.x,this.y,t,i);let s=Math.atan2(i-this.y,t-this.x);this.vx=Math.cos(s),this.vy=Math.sin(s)}is_attacked(t,i,s,e){if(i>0&&"me"!=this.character&&(this.need_draw_hp=!0,this.draw_hp_ftime=this.spent_time+this.draw_hp_time),e)for(let t=0;t<20+10*Math.random();t++){let t=this.x,i=this.y,s=.02*Math.random()*.2,e=2*Math.PI*Math.random(),a=Math.cos(e),h=Math.sin(e),r=this.color,n=1.6875,o=this.radius*Math.random()*10;new Particle(this.playground,t,i,s,a,h,r,n,o)}if(this.hp-=i,this.hp>this.style_three_max_hp&&this.hp<=this.style_two_max_hp)this.radius=this.style_two_radius,this.speed=this.style_two_speed;else if(this.hp>this.style_four_max_hp&&this.hp<=this.style_three_max_hp)this.radius=this.style_three_radius,this.speed=this.style_three_speed;else if(this.hp<=this.style_four_max_hp&&this.hp>0)this.radius=this.style_four_radius,this.speed=this.style_four_speed;else if(this.hp<=0)return"multi mode"===this.playground.mode&&"me"===this.character&&this.playground.mps.send_player_die(),this.destroy(),!1;s||(this.damage_x=Math.cos(t),this.damage_y=Math.sin(t),this.damage_speed=this.default_damage_speed)}receive_attack(t,i,s,e,a,h){h.destroy_fireball(a),this.x=t,this.y=i,this.is_attacked(s,e,!1,!0)}update(){this.spent_time+=this.timedelta/1e3,"multi mode"===this.playground.mode&&this.spent_time>this.next_update_pos&&"me"===this.character&&(this.next_update_pos++,this.playground.mps.send_update_player(this.hp,this.x,this.y,this.vx,this.vy,this.damage_x,this.damage_y,this.damage_speed)),"me"===this.character&&this.update_coldtime(),"me"===this.character&&this.playground.focus_player===this&&this.playground.re_cx_cy(this.x,this.y),this.update_move(),this.update_win(),("single mode"===this.playground.mode&&"me"===this.character||"multi mode"===this.playground.mode&&"fighting"===this.playground.state&&"me"===this.character)&&this.update_cold_mode(),null!=this.e_stime&&this.spent_time<this.e_ftime?this.blocked():null!=this.e_stime&&(this.e_stime=null),this.render()}update_cold_mode(){let t=this.playground.warmers,i=this.is_cold,s=this.is_cold_max,e=!0;for(let s=0;s<t.length;s++){if(this.get_dist(this.x,this.y,t[s].x,t[s].y)<3.5*t[s].radius){i&&(this.next_reduce_code_num=this.spent_time),this.is_cold_max=!1,this.is_cold=!1,e=!1;break}}e&&(this.is_cold=!0),this.is_cold&&this.spent_time>=this.next_update_code_num?this.cold_num=Math.min(this.cold_num+1,100):!this.is_cold&&this.spent_time>=this.next_reduce_code_num&&(this.cold_num=Math.max(0,this.cold_num-10)),i&&this.is_cold&&this.spent_time>=this.next_update_code_num?this.next_update_code_num++:!i&&this.is_cold?this.next_update_code_num=this.spent_time+1:!i&&!this.is_cold&&this.spent_time>=this.next_reduce_code_num&&this.next_reduce_code_num++,100!==this.cold_num||s||(this.is_cold_max=!0,this.next_reduce_hp=this.spent_time),this.is_cold_max&&this.spent_time>=this.next_reduce_hp&&(this.is_attacked(null,3,!0,!1),"multi mode"===this.playground.mode&&this.playground.mps.send_hp_decrease(this.uuid,3)),s&&this.spent_time>=this.next_reduce_hp&&this.next_reduce_hp++}update_win(){("fighting"===this.playground.state&&1===this.playground.players.length&&"me"===this.playground.players[0].character||"single mode"===this.playground.mode&&1===this.playground.players.length&&"me"===this.playground.players[0].character)&&this.playground.score_board.win()}update_coldtime(){this.d_can||this.spent_time>=this.d_make_time+this.d_cold_time&&(this.d_can=!0)}update_move(){if("robot"===this.character&&this.spent_time>5&&Math.random()<1/180){let t=null;if(this.playground.players.length<=10&&"me"===this.playground.players[0].character)t=this.playground.players[0];else if(1!=this.playground.players.length)for(t=this.playground.players[Math.floor(Math.random()*this.playground.players.length)];t===this;)t=this.playground.players[Math.floor(Math.random()*this.playground.players.length)];if(this.playground.players.length>1){let i=t.x+t.speed*this.vx*this.timedelta/1e3*.3,s=t.y+t.speed*this.vy*this.timedelta/1e3*.3,e=Math.random()<=.1;this.shoot_fireball(i,s,e)}}if((this.x+this.radius>=this.playground.virtual_map_width||this.x-this.radius<=0)&&(this.damage_speed>this.eps?(this.damage_x=-this.damage_x,this.damage_speed=1.5,this.is_attacked(null,5,!0,!0)):(this.damage_x=-this.vx,this.damage_y=this.vy,this.damage_speed=1.5)),(this.y+this.radius>=this.playground.virtual_map_height||this.y-this.radius<=0)&&(this.damage_speed>this.eps?(this.damage_y=-this.damage_y,this.damage_speed=1.5,this.is_attacked(null,5,!0,!0)):(this.damage_x=this.vx,this.damage_y=-this.vy,this.damage_speed=1.5)),this.damage_speed>this.eps)this.vx=this.vy=0,this.move_length=0,this.x+=this.damage_x*this.damage_speed*this.timedelta/1e3,this.y+=this.damage_y*this.damage_speed*this.timedelta/1e3,this.damage_speed*=this.friction;else if(this.move_length<this.eps){if(this.move_length=0,this.vx=this.vy=0,"robot"===this.character){let t=Math.random()*this.playground.virtual_map_width,i=Math.random()*this.playground.virtual_map_height;this.move_to(t,i)}}else{let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t}}render(){let t=this.playground.scale,i=this.x-this.playground.cx,s=this.y-this.playground.cy;if(!(i<-.2*this.playground.width/t||i>1.2*this.playground.width/t||s<-.2*this.playground.height/t||s>1.2*this.playground.height/t)){if("me"===this.character?(this.need_draw&&(this.ctx.beginPath(),this.ctx.arc(i*t,s*t,1.3*this.radius*t,0-Math.PI/2,Math.PI*(2*this.skill_ptime/this.q_cd)-Math.PI/2),this.ctx.lineWidth=1,this.skill_ptime<this.q_cd?this.ctx.strokeStyle="white":this.ctx.strokeStyle="CornflowerBlue","me"===this.playground.players[0].character&&this.ctx.stroke(),this.ctx.closePath()),this.e_show_circle&&(this.ctx.beginPath(),this.ctx.arc(i*t,s*t,1.2*this.radius*t,0,2*Math.PI,!1),this.ctx.lineWidth=1,this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.arc(i*t,s*t,1.4*this.radius*t,0,2*Math.PI,!1),this.ctx.lineWidth=1,this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.arc(i*t,s*t,1.6*this.radius*t,0,2*Math.PI,!1),this.ctx.lineWidth=1,this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.arc(i*t,s*t,1.8*this.radius*t,0,2*Math.PI,!1),this.ctx.lineWidth=1,this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.arc(i*t,s*t,2*this.radius*t,0,2*Math.PI,!1),this.ctx.lineWidth=1,this.ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this.ctx.stroke(),this.ctx.closePath()),this.d_show_circle&&(this.ctx.beginPath(),this.ctx.arc(i*t,s*t,15*this.radius*t,0,2*Math.PI,!1),this.ctx.lineWidth=1,this.ctx.strokeStyle="rgba(255, 99, 71, 0.6)",this.ctx.stroke(),this.ctx.closePath()),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i*t,s*t,this.radius*t,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.img,(i-this.radius)*t,(s-this.radius)*t,2*this.radius*t,2*this.radius*t),this.ctx.restore()):(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i*t,s*t,this.radius*t,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.img,(i-this.radius)*t,(s-this.radius)*t,2*this.radius*t,2*this.radius*t),this.ctx.restore()),"me"!=this.character&&null!=this.draw_hp_ftime&&this.spent_time<=this.draw_hp_ftime){let e=this.hp,a=null;a=e>this.style_two_max_hp?"white":e>this.style_three_max_hp?"NavajoWhite":e>this.style_four_max_hp?"LightSalmon":"Tomato",this.ctx.beginPath(),this.ctx.arc(i*t,s*t,1.3*this.radius*t,(100-e)/100*Math.PI*2-Math.PI/2,2*Math.PI-Math.PI/2),this.ctx.lineWidth=2,this.ctx.strokeStyle=a,this.ctx.stroke(),this.ctx.closePath()}else"robot"===this.character&&null!=this.draw_hp_ftime&&(this.draw_hp_ftime=null);if(this.playground.players.length>0&&"me"===this.playground.players[0].character){let t=this.playground.players[0].hp;this.ctx.fillStyle="white",this.ctx.font=(.05*this.playground.height).toString()+"px Arial",this.ctx.fillText("hp: ",.25*this.playground.width,.9*this.playground.height),this.ctx.lineWidth=1,this.ctx.strokeStyle="white",this.ctx.strokeRect(.35*this.playground.width,.85*this.playground.height,.3*this.playground.width,.015*this.playground.height),this.ctx.fillStyle="LightSkyBlue",this.ctx.fillRect(.352*this.playground.width,.852*this.playground.height,.296*this.playground.width*this.playground.players[0].cold_num/100,.01*this.playground.height),this.ctx.lineWidth=1,this.ctx.strokeStyle="white",this.ctx.strokeRect(.298*this.playground.width,.895*this.playground.height,.404*this.playground.width,.05*this.playground.height);let i=null;i=t>this.style_two_max_hp?"PaleGreen":t>this.style_three_max_hp?"NavajoWhite":t>this.style_four_max_hp?"LightSalmon":"Tomato",this.ctx.fillStyle=i,this.ctx.fillRect(.3*this.playground.width,.9*this.playground.height,.4*this.playground.width*this.playground.players[0].hp/100,.04*this.playground.height)}}}on_destroy(){"me"!==this.character||"single mode"!==this.playground.mode&&"fighting"!==this.playground.state||this.playground.score_board.lose(),"me"===this.character&&"multi mode"===this.playground.mode&&(this.playground.state="over",this.playground.notice_board.write("Over"));for(let t=0;t<this.playground.players.length;t++)if(this.playground.players[t]===this){this.playground.players.splice(t,1);break}}}class ScoreBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.state=null,this.win_img=new Image,this.win_img.src="https://cdn.acwing.com/media/article/image/2021/12/17/1_8f58341a5e-win.png",this.lose_img=new Image,this.lose_img.src="https://git.acwing.com/RyanMoriarty/homework/-/raw/master/utils/Noob.png"}start(){}add_listening_events(){let t=this,i=null;this.playground.game_map.$canvas&&(i=this.playground.game_map.$canvas),i&&i.on("click",(function(){t.playground.hide(),t.playground.root.menu.show()}))}win(){this.state="win";let t=this;setTimeout((function(){t.add_listening_events()}),1e3)}lose(){this.state="lose";let t=this;setTimeout((function(){t.add_listening_events()}),1e3)}late_update(){this.render()}render(){"win"===this.state?(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.playground.width/2,this.playground.height/2,.15*this.playground.height,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.win_img,this.playground.width/2-.15*this.playground.height,this.playground.height/2-.15*this.playground.height,.15*this.playground.height*2,.15*this.playground.height*2),this.ctx.restore()):"lose"===this.state&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(this.playground.width/2,this.playground.height/2,.15*this.playground.height,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.lose_img,this.playground.width/2-.15*this.playground.height,this.playground.height/2-.15*this.playground.height,.15*this.playground.height*2,.15*this.playground.height*2),this.ctx.restore())}}class DiffusionBall extends AcGameObject{constructor(t,i,s,e,a,h,r,n,o,l,d){super(),this.playground=t,this.ctx=this.playground.game_map.ctx,this.x=i,this.y=s,this.radius=e,this.vx=a,this.vy=h,this.color=r,this.speed=n,this.move_length=o,this.origin_move_length=o,this.is_first=d,this.player=l,this.friction=.95,this.eps=.01}get_dist(t,i,s,e){let a=t-s,h=i-e;return Math.sqrt(a*a+h*h)}start(){}update(){if(this.move_length<this.eps||this.speed<this.eps){if(this.is_first){for(let t=0;t<22.5;t++){let i=.002,s=Math.PI/11.25*t,e=Math.cos(s),a=Math.sin(s),h="rgba(255,99,71, 0.6)",r=.84375,n=2*this.origin_move_length;new DiffusionBall(this.playground,this.x,this.y,i,e,a,h,r,n,this.player,!1)}if("me"===this.player.character)for(let t=0;t<AC_GAME_OBJECTS.length;t++){let i=AC_GAME_OBJECTS[t];if(i instanceof Player){let t=i;if(t!=this.player){if(this.get_dist(this.x,this.y,t.x,t.y)<2*this.origin_move_length){let i=Math.atan2(t.y-this.y,t.x-this.x);t.is_attacked(i,1,!1,!0),"multi mode"===this.playground.mode&&this.playground.mps.send_attack(t.uuid,t.x,t.y,i,1,null)}}}else if(i instanceof FireBall&&i.player!=this.player){this.get_dist(this.x,this.y,i.x,i.y)<2*this.origin_move_length&&("single mode"===this.playground.mode?i.destroy():this.playground.mps.send_destroy_ball(i.player.uuid,i.uuid))}}}return this.destroy(),!1}let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t,this.speed*=this.friction,this.render()}render(){let t=this.playground.scale,i=this.x-this.playground.cx,s=this.y-this.playground.cy;i<-.2*this.playground.width/t||i>1.2*this.playground.width/t||s<-.2*this.playground.height/t||s>1.2*this.playground.height/t||(this.ctx.beginPath(),this.ctx.arc(i*t,s*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill())}}class FireBall extends AcGameObject{constructor(t,i,s,e,a,h,r,n,o,l,d,c,g){super(),this.playground=t,this.player=i,this.ctx=this.playground.game_map.ctx,this.x=s,this.y=e,this.vx=h,this.vy=r,this.radius=a,this.color=n,this.speed=o,this.move_length=l,this.eps=.05,this.damage=d,this.origin_move_length=this.move_length,this.is_elastic=g,this.special_effect=c}start(){}update(){if(this.move_length<this.eps)return this.special_effect&&this.se_imp(),"multi mode"===this.playground.mode&&this.on_destroy(),this.destroy(),!1;this.update_move(),("single mode"===this.playground.mode||"enemy"===this.player.character)&&this.update_attack(),this.render()}update_move(){let t=Math.min(this.move_length,this.speed*this.timedelta/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t,this.is_elastic&&((this.x-this.radius<=0||this.x+this.radius>=this.playground.virtual_map_width)&&(this.vx=-this.vx),(this.y-this.radius<=0||this.y+this.radius>=this.playground.virtual_map_height)&&(this.vy=-this.vy))}update_attack(){for(let t=0;t<this.playground.players.length;t++){let i=this.playground.players[t];if(this.player!=i&&this.is_collision(i)){this.attack(i);break}}}get_dist(t,i,s,e){let a=t-s,h=i-e;return Math.sqrt(a*a+h*h)}is_collision(t){if(this.playground.players.length<=1)return!1;if("robot"===this.player.character&&this.playground.players.length<20)if("me"===this.playground.players[0].character){if("me"===t.character){if(this.get_dist(this.x,this.y,t.x,t.y)<this.radius+t.radius)return!0}}else{if(this.get_dist(this.x,this.y,t.x,t.y)<this.radius+t.radius)return!0}else{if(this.get_dist(this.x,this.y,t.x,t.y)<this.radius+t.radius)return!0}return!1}se_imp(){for(let t=0;t<10;t++){let t=2*Math.PI*Math.random(),i=Math.cos(t),s=Math.sin(t),e=null,a=Math.random();if(e="me"===this.player.character?a<=.5?"WhiteSmoke":"CornflowerBlue":"OrangeRed","single mode"===this.playground.mode)new FireBall(this.playground,this.player,this.x,this.y,this.radius/1.5,i,s,e,.5*this.speed,this.origin_move_length/4,this.damage/2,!1,!0);else if("me"===this.player.character){let t=new FireBall(this.playground,this.player,this.x,this.y,this.radius/1.5,i,s,e,.5*this.speed,this.origin_move_length/4,this.damage/2,!1,!0);this.player.fireballs.push(t),this.playground.mps.send_create_ball(this.player.uuid,t.uuid,this.x,this.y,this.radius/1.5,i,s,"OrangeRed",.5*this.speed,this.origin_move_length/4,this.damage/2,!1,!0)}}}update_ball_trace(t,i,s,e,a){this.x=t,this.y=i,this.vx=s,this.vy=e,this.move_length=a}attack(t){let i=Math.atan2(t.y-this.y,t.x-this.x);if(this.is_elastic){let t=2*Math.random()*Math.PI,i=Math.cos(t),s=Math.sin(t);this.vx=i,this.vy=s,"me"===this.player.character||"enemy"===this.player.character?(this.move_length=1.5*this.origin_move_length,"multi mode"===this.playground.mode&&this.playground.mps.send_update_ball_trace(this.player.uuid,this.uuid,this.x,this.y,i,s,this.move_length)):this.move_length=.8*this.origin_move_length}else this.destroy(),this.special_effect&&this.se_imp();t.is_attacked(i,this.damage,!1,!0),"multi mode"===this.playground.mode&&this.playground.mps.send_is_attack(this.player.uuid,t.x,t.y,i,this.damage,this.uuid)}render(){let t=this.playground.scale,i=this.x-this.playground.cx,s=this.y-this.playground.cy;i<-.2*this.playground.width/t||i>1.2*this.playground.width/t||s<-.2*this.playground.height/t||s>1.2*this.playground.height/t||(this.ctx.beginPath(),this.ctx.arc(i*t,s*t,this.radius*t,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill())}on_destroy(){let t=this.player.fireballs;for(let i=0;i<t.length;i++)if(t[i]===this){t.splice(i,1);break}}}class MultiPlayerSocket{constructor(t){this.playground=t,this.ws=new WebSocket("wss://app1449.acapp.acwing.com.cn/wss/multiplayer/"),this.start()}start(){this.receive()}receive(){let t=this;this.ws.onmessage=function(i){let s=JSON.parse(i.data),e=s.event,a=s.uuid;if(a===t.uuid)return!1;"create_player"===e?t.receive_create_player(a,s.username,s.sure_skin,s.player_x,s.player_y):"move_to"===e?t.receive_move_to(a,s.tx,s.ty):"shoot_fireball"===e?t.receive_shoot_fireball(a,s.tx,s.ty,s.ball_uuid,s.is_se):"attack"===e?t.receive_attack(a,s.attackee_uuid,s.x,s.y,s.angle,s.damage,s.ball_uuid):"update_ball_trace"===e?t.receive_update_ball_trace(s.owner_uuid,s.ball_uuid,s.x,s.y,s.vx,s.vy,s.move_length):"create_ball"===e?t.receive_create_ball(s.uuid,s.ball_uuid,s.x,s.y,s.radius,s.vx,s.vy,s.color,s.speed,s.move_length,s.damage,s.se,s.is_elastic):"block"===e?t.receive_block(s.blocker_uuid,s.blockee_uuid,s.ball_uuid,s.vx,s.vy,s.angle):"hp_decrease"===e?t.receive_hp_decrease(s.uuid,s.damage):"destroy_ball"===e?t.receive_destroy_ball(s.owner_uuid,s.ball_uuid):"update_damage_player"===e?t.receive_update_damage_player(s.damager_uuid,s.damage_x,s.damage_y,s.damage_speed,s.x,s.y):"is_attack"===e?t.receive_is_attack(s.uuid,s.attacker_uuid,s.x,s.y,s.angle,s.damage,s.ball_uuid):"message"===e?t.receive_message(a,s.username,s.text):"make_particle"===e?t.receive_make_particle(s.x,s.y,s.vx,s.vy,s.radius,s.color,s.speed,s.move_length):"update_player"===e?t.receive_update_player(a,s.hp,s.x,s.y,s.vx,s.vy,s.damage_x,s.damage_y,s.damage_speed):"player_die"===e?t.receive_player_die(a):"make_diffusion_ball"===e&&t.receive_make_diffusion_ball(a)}}send_create_player(t,i,s,e){this.ws.send(JSON.stringify({event:"create_player",uuid:this.uuid,username:t,sure_skin:i,player_x:s,player_y:e}))}get_player(t){let i=this.playground.players;for(let s=0;s<i.length;s++){let e=i[s];if(e.uuid===t)return e}return null}get_player_ball(t,i){let s=this.get_player(t).fireballs;for(let t=0;t<s.length;t++)if(i===s[t].uuid)return s[t];return null}receive_create_player(t,i,s,e,a){let h=new Player(this.playground,e,a,.05,this.playground.get_random_color(),.15,"enemy",i,s);h.uuid=t,this.playground.players.push(h)}send_move_to(t,i){this.ws.send(JSON.stringify({event:"move_to",uuid:this.uuid,tx:t,ty:i}))}receive_move_to(t,i,s){let e=this.get_player(t);e&&e.move_to(i,s)}send_shoot_fireball(t,i,s,e){this.ws.send(JSON.stringify({event:"shoot_fireball",uuid:this.uuid,tx:t,ty:i,ball_uuid:s,is_se:e}))}receive_shoot_fireball(t,i,s,e,a){let h=this.get_player(t);if(h){let t=null;t=a?h.shoot_fireball(i,s,!0):h.shoot_fireball(i,s,!1),t.uuid=e}}send_attack(t,i,s,e,a,h){this.ws.send(JSON.stringify({event:"attack",uuid:this.uuid,attackee_uuid:t,x:i,y:s,angle:e,damage:a,ball_uuid:h}))}receive_attack(t,i,s,e,a,h,r){let n=this.get_player(t),o=this.get_player(i);o&&n&&o.receive_attack(s,e,a,h,r,n)}send_is_attack(t,i,s,e,a,h){this.ws.send(JSON.stringify({event:"is_attack",uuid:this.uuid,attacker_uuid:t,x:i,y:s,angle:e,damage:a,ball_uuid:h}))}receive_is_attack(t,i,s,e,a,h,r){let n=this.get_player(i),o=this.get_player(t);o&&n&&o.receive_attack(s,e,a,h,r,n)}send_update_ball_trace(t,i,s,e,a,h,r){this.ws.send(JSON.stringify({event:"update_ball_trace",owner_uuid:t,x:s,y:e,vx:a,vy:h,ball_uuid:i,move_length:r}))}receive_update_ball_trace(t,i,s,e,a,h,r){let n=this.get_player_ball(t,i);n&&n.update_ball_trace(s,e,a,h,r)}send_create_ball(t,i,s,e,a,h,r,n,o,l,d,c,g){this.ws.send(JSON.stringify({event:"create_ball",uuid:t,x:s,y:e,vx:h,vy:r,color:n,radius:a,speed:o,move_length:l,damage:d,se:c,is_elastic:g,ball_uuid:i}))}receive_create_ball(t,i,s,e,a,h,r,n,o,l,d,c,g){let p=this.get_player(t);if(p){let t=new FireBall(this.playground,p,s,e,a,h,r,n,o,l,d,c,g);t.uuid=i,p.fireballs.push(t)}}send_block(t,i,s,e,a,h){this.ws.send(JSON.stringify({event:"block",blocker_uuid:t,blockee_uuid:i,ball_uuid:s,vx:e,vy:a,angle:h}))}receive_block(t,i,s,e,a,h){let r=this.get_player(t);if(this.get_player(i)&&r){let t=this.get_player_ball(i,s);if(t){t.vx=e,t.vy=a,t.special_effect||(t.player=r,"me"===r.character?t.color="CornflowerBlue":t.color="OrangeRed",t.speed=.15*3,t.is_elastic=!0,t.special_effect=!0,t.move_length=t.origin_move_length);for(let i=0;i<15+10*Math.random();i++){let i=.2*t.radius,s=h;Math.random()>.5?s+=1*Math.random()/6*Math.PI:s-=1*Math.random()/6*Math.PI;let e=Math.cos(s),a=Math.sin(s),n=t.color,o=1.125+1.125*Math.random(),l=10*r.radius*Math.random();new Particle(this.playground,t.x,t.y,i,e,a,n,o,l)}r.damage_speed=.4*r.default_damage_speed,r.damage_x=Math.cos(h-Math.PI),r.damage_y=Math.sin(h-Math.PI),r.fireballs.push(t)}}}send_hp_decrease(t,i){this.ws.send(JSON.stringify({event:"hp_decrease",uuid:t,damage:i}))}receive_hp_decrease(t,i){let s=this.get_player(t);s&&s.uuid!=this.uuid&&s.is_attacked(null,i,!0,!1)}send_destroy_ball(t,i){this.ws.send(JSON.stringify({event:"destroy_ball",owner_uuid:t,ball_uuid:i}))}receive_destroy_ball(t,i){if(this.get_player(t)){let s=this.get_player_ball(t,i);s&&(s.on_destroy(),s.destroy())}}send_update_damage_player(t,i,s,e,a,h){this.ws.send(JSON.stringify({event:"update_damage_player",damager_uuid:t,damage_x:i,damage_y:s,damage_speed:e,x:a,y:h}))}receive_update_damage_player(t,i,s,e,a,h){let r=this.get_player(t);r&&(r.x=a,r.y=h,r.damage_x=i,r.damage_y=s,r.damage_speed=e)}send_message(t,i){this.ws.send(JSON.stringify({event:"message",uuid:this.uuid,text:i,username:t}))}receive_message(t,i,s){this.playground.chat_field.add_message(i,s)}send_make_particle(t,i,s,e,a,h,r,n){this.ws.send(JSON.stringify({event:"make_particle",uuid:this.uuid,x:t,y:i,vx:s,vy:e,radius:a,color:h,speed:r,move_length:n}))}receive_make_particle(t,i,s,e,a,h,r,n){new Particle(this.playground,t,i,.5*a+a*Math.random(),s,e,h,r,.5*n+n*Math.random())}send_update_player(t,i,s,e,a,h,r,n){this.ws.send(JSON.stringify({event:"update_player",uuid:this.uuid,hp:t,x:i,y:s,vx:e,vy:a,damage_x:h,damage_y:r,damage_speed:n}))}receive_update_player(t,i,s,e,a,h,r,n,o){let l=this.get_player(t);l&&(l.hp=i,l.x=s,l.y=e,l.vx=a,l.vy=h,l.damage_x=r,l.damage_y=n,l.damage_speed=o)}send_player_die(){this.ws.send(JSON.stringify({event:"player_die",uuid:this.uuid}))}receive_player_die(t){let i=this.get_player(t);i&&i.destroy()}send_make_diffusion_ball(){this.ws.send(JSON.stringify({event:"make_diffusion_ball",uuid:this.uuid}))}receive_make_diffusion_ball(t){let i=this.get_player(t);i&&i.diffusion()}}class Warmer extends AcGameObject{constructor(t,i,s,e){super(),this.playground=t,this.x=i,this.y=s,this.radius=e,this.ctx=this.playground.game_map.ctx,this.inner_radius=.5*this.radius,this.spent_time=0,this.change_next=1,this.next_radius=this.radius}start(){}update(){if(this.spent_time+=this.timedelta/1e3,this.spent_time>this.change_next&&(this.change_next+=.5*Math.random(),this.next_radius=.6*this.radius+Math.random()*this.radius,this.next_radius>this.radius&&(this.next_radius=this.radius),Math.random()>.5))for(let t=0;t<15+10*Math.random();t++){let t=this.inner_radius*Math.random()*.15,i=2*Math.PI*Math.random(),s=Math.cos(i),e=Math.sin(i),a="rgba(255,99,71, 0.6)",h=1.6875,r=this.radius*Math.random()*10;new Particle(this.playground,this.x,this.y,t,s,e,a,h,r)}this.inner_radius<this.next_radius?this.inner_radius+=.001:this.inner_radius-=.001,this.render()}render(){let t=this.playground.scale,i=this.x-this.playground.cx,s=this.y-this.playground.cy;if(i<-.2*this.playground.width/t||i>1.2*this.playground.width/t||s<-.2*this.playground.height/t||s>1.2*this.playground.height/t)return;this.ctx.beginPath(),this.ctx.arc(i*t,s*t,this.inner_radius*t,0,2*Math.PI,!1);let e=this.ctx.createRadialGradient(i*t,s*t,0,i*t,s*t,this.inner_radius*t);e.addColorStop(0,"rgba(255,69,0, 0.8)"),e.addColorStop(.5,"rgba(255,99,71)"),e.addColorStop(1,"rgba(176,224,230, 0.4)"),this.ctx.fillStyle=e,this.ctx.fill(),this.ctx.restore(),this.ctx.closePath()}}class AcGamePlayground{constructor(t){this.root=t,this.$playground=$('<div class="ac-game-playground"></div>'),this.hide(),this.root.$ac_game.append(this.$playground),this.start()}get_random_color(){let t=["LightSkyBlue","cyan","pink","Moccasin","PaleGreen","Violet","Tomato","Silver"];return t[Math.floor(Math.random()*t.length)]}get_random_enemys(){return enemys[Math.floor(Math.random()*enemys.length)]}create_uuid(){let t="";for(let i=0;i<20;i++){t+=parseInt(Math.floor(10*Math.random()))}return t}start(){let t=this,i=this.create_uuid();$(window).on(`resize.${i}`,(function(){t.resize()})),this.root.AcWingOS&&this.root.AcWingOS.api.window.on_close((function(){$(window).off(`resize.${i}`)}))}resize(){this.width=this.$playground.width(),this.height=this.$playground.height();let t=Math.min(this.width/16,this.height/9);this.width=16*t,this.height=9*t,this.scale=this.height,this.game_map&&this.game_map.resize(),this.mini_map&&this.mini_map.resize(),this.chat_field&&this.chat_field.resize()}re_cx_cy(t,i){this.cx=Math.max(t-.5*this.width/this.scale,0),this.cx=Math.min(this.cx,this.virtual_map_width-this.width/this.scale),this.cy=Math.max(i-.5*this.height/this.scale,0),this.cy=Math.min(this.cy,this.virtual_map_height-1)}show(t,i){let s=this;this.$playground.show(),this.virtual_map_width=4,this.virtual_map_height=this.virtual_map_width,this.game_map=new GameMap(this),this.game_music=new GameMusic(this),this.cold_warning=new ColdWarning(this),this.mode=t,this.score_board=new ScoreBoard(this),this.multi_bgm=!1,this.resize(),this.players=[],this.fireballs=[],this.warmers=[],this.snows=[],this.warmers.push(new Warmer(this,.1*this.virtual_map_width,.1*this.virtual_map_height,.1)),this.warmers.push(new Warmer(this,.9*this.virtual_map_width,.1*this.virtual_map_height,.1)),this.warmers.push(new Warmer(this,.1*this.virtual_map_width,.9*this.virtual_map_height,.1)),this.warmers.push(new Warmer(this,.9*this.virtual_map_width,.9*this.virtual_map_height,.1)),this.warmers.push(new Warmer(this,.5*this.virtual_map_width,.5*this.virtual_map_height,.1));let e=Math.random()*this.virtual_map_width;for(;e+.05>=this.virtual_map_width||e-.05<=0;)e=Math.random()*this.virtual_map_width;let a=Math.random()*this.virtual_map_height;for(;a+.05>=this.virtual_map_height||a-.05<=0;)a=Math.random()*this.virtual_map_height;if(this.players.push(new Player(this,e,a,.05,"white",.15,"me",this.root.settings.username,i)),this.re_cx_cy(this.players[0].x,this.players[0].y),this.focus_player=this.players[0],"single mode"===t)for(let t=0;t<45;t++){let t=Math.random()*this.virtual_map_width,i=Math.random()*this.virtual_map_height;this.players.push(new Player(this,t,i,.05,this.get_random_color(),.15,"robot",0))}else"multi mode"===t&&(this.chat_field=new ChatField(this),this.mps=new MultiPlayerSocket(this),this.mps.uuid=this.players[0].uuid,this.notice_board=new NoticeBoard(this),this.player_count=0,this.state="waiting",this.mps.ws.onopen=function(){s.mps.send_create_player(s.root.settings.username,i,e,a)});this.mini_map=new MiniMap(this),this.mini_map.resize()}hide(){for(;this.players&&this.players.length>0;){for(;this.players[0].fireballs&&this.players[0].fireballs.length>0;)this.players[0].fireballs[0].destroy();this.players[0].destroy()}for(;this.warmers&&this.warmers.length>0;)this.warmers[0].destroy(),this.warmers.splice(0,1);this.notice_board&&(this.notice_board.destroy(),this.notice_board=null),this.score_board&&(this.score_board.destroy(),this.score_board=null),this.mini_map&&(this.mini_map.destroy(),this.mini_map=null),this.game_map&&(this.game_map.destroy(),this.game_map=null),this.$playground.empty(),this.$playground.hide()}}class GameMusic{constructor(t){this.playground=t,this.$bgm=$("<audio class=\"ac-game-playground-bgm\" src=\"\" autoplay='autoplay' loop='loop'></audio>"),this.playground.$playground.append(this.$bgm);document.getElementsByClassName("ac-game-playground-bgm")[0]}show(){this.$bgm.show()}hide(){this.$bgm.hide()}stop(){this.$bgm.stop()}}class Settings{constructor(t){this.root=t,this.platform="WEB",this.root.AcWingOS&&(this.platform="ACAPP"),this.username="",this.photo="",this.$settings=$('<div class="ac-game-settings">\n    <div class = "ac-game-settings-login">\n        <div class = "ac-game-settings-title">\n            Login\n        </div>\n        <div class = "ac-game-settings-username">\n            <div class = "ac-game-settings-item">\n                <input type ="text" placeholder = "用户名">\n            </div>\n        </div>\n        <div class = "ac-game-settings-password">\n            <div class = "ac-game-settings-item">\n                <input type ="password" placeholder = "密码">\n            </div>\n        </div>\n\n        <div class = "ac-game-settings-submit">\n            <div class = "ac-game-settings-item">\n                <button>登录</botton>\n            </div>\n        </div>\n\n        <div class = "ac-game-settings-error-message">\n        </div>\n\n        <div class = "ac-game-settings-option">\n            注册\n        </div>\n        <br>\n        <div class = "ac-game-settings-logo">\n            <image width="40" src="https://git.acwing.com/RyanMoriarty/homework/-/raw/master/ganyu.png">\n            \n            <div>\n                CoCo Goat一键登录\n            </div>\n        </div>\n    </div>\n\n    <div class = "ac-game-settings-register">\n        <div class="ac-game-settings-title">\n            注册\n        </div>\n        <div class="ac-game-settings-username">\n            <div class="ac-game-settings-item">\n                <input type="text" placeholder="用户名">\n            </div>\n        </div>\n        <div class="ac-game-settings-password ac-game-settings-password-first">\n            <div class="ac-game-settings-item">\n                <input type="password" placeholder="密码">\n            </div>\n        </div>\n        <div class="ac-game-settings-password ac-game-settings-password-second">\n            <div class="ac-game-settings-item">\n                <input type="password" placeholder="确认密码">\n            </div>\n        </div>\n        <div class="ac-game-settings-submit">\n            <div class="ac-game-settings-item">\n                <button>注册</button>\n            </div>\n        </div>\n        <div class="ac-game-settings-error-message">\n        </div>\n        <div class="ac-game-settings-option">\n            登录\n        </div>\n        <br>\n        <div class="ac-game-settings-logo">\n            <image width="40" src="https://git.acwing.com/RyanMoriarty/homework/-/raw/master/ganyu.png">\n            <div>\n                CoCo Goat一键登录\n            </div>\n        </div>\n    </div>\n</div>\n'),this.$login=this.$settings.find(".ac-game-settings-login"),this.$login_username=this.$login.find(".ac-game-settings-username input"),this.$login_password=this.$login.find(".ac-game-settings-password input"),this.$login_submit=this.$login.find(".ac-game-settings-submit button"),this.$login_error_message=this.$login.find(".ac-game-settings-error-message"),this.$login_register=this.$login.find(".ac-game-settings-option"),this.$login.hide(),this.$register=this.$settings.find(".ac-game-settings-register"),this.$register_username=this.$register.find(".ac-game-settings-username input"),this.$register_password=this.$register.find(".ac-game-settings-password-first input"),this.$register_password_confirm=this.$register.find(".ac-game-settings-password-second input"),this.$register_submit=this.$register.find(".ac-game-settings-submit button"),this.$register_error_message=this.$register.find(".ac-game-settings-error-message"),this.$register_login=this.$register.find(".ac-game-settings-option"),this.$register.hide(),this.$coco_goat_login=this.$settings.find(".ac-game-settings-logo img"),this.root.$ac_game.append(this.$settings),this.start()}start(){"ACAPP"===this.platform?this.getinfo_acapp():(this.getinfo_web(),this.add_listening_events())}add_listening_events(){let t=this;this.add_listening_events_login(),this.add_listening_events_register(),this.$coco_goat_login.click((function(){t.coco_goat_login()}))}coco_goat_login(){$.ajax({url:"https://app1449.acapp.acwing.com.cn/settings/acwing/web/apply_code/",type:"GET",success:function(t){"success"===t.result&&window.location.replace(t.apply_code_url)}})}add_listening_events_login(){let t=this;this.$login_register.click((function(){t.register()})),this.$login_submit.click((function(){t.login_on_remote()}))}add_listening_events_register(){let t=this;this.$register_login.click((function(){t.login()})),this.$register_submit.click((function(){t.register_on_remote()}))}login_on_remote(){let t=this,i=this.$login_username.val(),s=this.$login_password.val();this.$login_error_message.empty(),$.ajax({url:"https://app1449.acapp.acwing.com.cn/settings/login/",type:"GET",data:{username:i,password:s},success:function(i){"success"===i.result?location.reload():t.$login_error_message.html(i.result)}})}register_on_remote(){let t=this,i=this.$register_username.val(),s=this.$register_password.val(),e=this.$register_password_confirm.val();this.$register_error_message.empty(),$.ajax({url:"https://app1449.acapp.acwing.com.cn/settings/register/",type:"GET",data:{username:i,password:s,password_confirm:e},success:function(i){"success"===i.result?location.reload():t.$register_error_message.html(i.result)}})}logout_on_remote(){"ACAPP"===this.platform?this.root.AcWingOS.api.window.close():$.ajax({url:"https://app1449.acapp.acwing.com.cn/settings/logout/",type:"GET",success:function(t){"success"===t.result&&location.reload()}})}register(){this.$login.hide(),this.$register.show()}login(){this.$register.hide(),this.$login.show()}acapp_login(t,i,s,e){let a=this;this.root.AcWingOS.api.oauth2.authorize(t,i,s,e,(function(t){"success"===t.result&&(a.username=t.username,a.photo=t.photo,a.hide(),a.root.menu.show())}))}getinfo_acapp(){let t=this;$.ajax({url:"https://app1449.acapp.acwing.com.cn/settings/acwing/acapp/apply_code/",type:"GET",success:function(i){"success"===i.result&&t.acapp_login(i.appid,i.redirect_uri,i.scope,i.state)}})}getinfo_web(){let t=this;$.ajax({url:"https://app1449.acapp.acwing.com.cn/settings/getinfo/",type:"GET",data:{platform:t.platform},success:function(i){"success"===i.result?(t.username=i.username,t.photo=i.photo,t.hide(),t.root.menu.show()):t.login()}})}hide(){this.$settings.hide()}show(){this.$settings.show()}}export class AcGame{constructor(t,i){console.log(i),this.id=t,this.$ac_game=$("#"+t),this.AcWingOS=i,this.choose_skin=new ChooseSkin(this),this.settings=new Settings(this),this.menu=new AcGameMenu(this),this.playground=new AcGamePlayground(this),this.start()}start(){for(let t=0;t<meme.length;t++){let i=new Image;i.src=meme[t],imgs.push(i)}for(let t=0;t<enemys.length;t++){let i=new Image;i.src=enemys[t],imgs.push(i)}}}let meme=["https://git.acwing.com/RyanMoriarty/homework/-/raw/master/utils/wenhao.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/ayaka.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/ganyu.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/hutao.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/kelee.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/zhongli.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/abeiduo.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/jean.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/eula.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/xiaogong.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/wanye.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/keqing.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/raidenshogu.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/sangonomiya.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/windy.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/xiao.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/childe.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/mona.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genshin_meme/qiqi.jpg"],imgs=[],skin_name=["随机皮肤","爱妻绫华","椰奶肥羊","嗷~嗷~","炸鱼禁闭","白吃白喝","天坑硕导","福报民工","记仇真君","军火贩子","枫原万叶","牛杂将军","煮饭宅女","藤原心海","哎嘿摸鱼","劲腰裸舞","达达利鸭","算命真香","椰~椰奶"],enemys=["https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genmo/QQ_flight.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genmo/QQ_lay.png","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genmo/QQ_mail.jpg","https://git.acwing.com/RyanMoriarty/homework/-/raw/master/genmo/QQ_people.jpg"],music_src=["","https://app27.acapp.acwing.com.cn/static/audio/playground/ayaka.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/ganyu.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/hutao.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/kelee.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/zhongli.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/abeiduo.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/jean.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/eula.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/xiaogong.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/wanye.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/keqing.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/raidenshogun.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/kokomi.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/windy.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/xiao.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/childe.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/mona.mp3","https://app27.acapp.acwing.com.cn/static/audio/playground/qiqi.mp3"],choose_skin_bgm=["","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/ayaka.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/ganyu.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/hutao.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/kelee.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/zhongli.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/abeiduo.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/jean.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/eula.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/xiaogong.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/wanye.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/keqing.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/raidenshogun.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/kokomi.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/windy.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/xiao.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/childe.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/mona.mp3","https://app27.acapp.acwing.com.cn/static/audio/choose_skin/qiqi.mp3"],multi_bgm="https://app27.acapp.acwing.com.cn/static/audio/playground/multi.mp3",menu_bgm="https://app27.acapp.acwing.com.cn/static/audio/menu/menu.mp3";
